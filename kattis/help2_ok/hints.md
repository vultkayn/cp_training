`The pattern never exceeds 100 characters` is the most important clue, as it means we can get a polynomial algorithm up to $n^4$ all the while remaining below $10^8$ complexity. In this case, coming up with a naive algorithm should be enough.

`union find` might also be a solution
